---
author: "VerÃ³nica Cruz Alonso, Marina Rodes Blanco, JuliÃ¡n Tijerin TriviÃ±o y Paloma Ruiz Benito"
date: today
date-format: "DD/MM/YYYY"
toc: true
toc-depth: 5
toc-title: "Ãndice"
format:
  html:
    link-external-newwindow: true
    title: DÃ­a 4 - Manejo y visualizaciÃ³n de datos en R
    subtitle: Trabajo reproducible y colaborativo
  gfm: 
    title: "DÃ­a 4 - Manejo y visualizaciÃ³n de datos en R"
editor: visual
editor_options: 
  chunk_output_type: console
number-sections: true
bibliography: references.bib
---

```         
```

![](images/clipboard-77513458.png)

Paloma Ruiz Benito (paloma.ruizb\@uah), VerÃ³nica Cruz-Alonso (veronica.cruza\@uah), Marina Rodes Blanco (marina.rodesb\@uah.es) y JuliÃ¡n Tijerin TriviÃ±o (julian.tijerint\@uah.es) somos investigadores de la Universidad de AlcalÃ¡, en el grupo de EcologÃ­a y RestauraciÃ³n Forestal (<https://portalcientifico.uah.es/grupos/9603/detalle>) y en el Grupo de InvestigaciÃ³n en TeledetecciÃ³n Ambiental (<https://geogra.uah.es/gita/>).

Junto con Julen Astigarraga Urcelay (colaborador y amigo), publicamos los materiales de los curso que impartimos en DatSciR.

Y vosotros **Â¿quiÃ©nes sois?**

LINK ENCUESTA: <https://forms.gle/zmqTKWiwM3qVtJi79>

Ahora os toca presentaros a la clase, para que este curso tambiÃ©n sirva para conocernos todos un poco mejor.

Es vuestro turno, decirnos:

-   Nombre y apellidos,

-   el Ã¡rea y departamento en el que trabajÃ¡is,

-   sobre quÃ© es vuestra tesis

-   cÃ³mo usÃ¡is o planeÃ¡s usar R

-   quÃ© esperÃ¡is del curso

-   cualquier otra cosa relevante....

**Â¿Y quÃ© es R y de dÃ³nde procede?**

[Un poco de historia de R contada por Jumping Rivers](https://www.jumpingrivers.com/misc/timeline/)

![](images/Rhistory.png){width="594"}

## PresentaciÃ³n

En este curso exploraremos los **fundamentos teÃ³ricos** y las **aplicaciones prÃ¡cticas** de la ciencia de datos en R. Combinaremos material preparado con los problemas especÃ­ficos de cada asistente, los cuales irÃ¡n evolucionando dÃ­a a dÃ­a. El objetivo principal es que tanto aquellos con conocimientos bÃ¡sicos en ciencia de datos como aquellos con un nivel mÃ¡s avanzado puedan beneficiarse y llevar consigo nuevos aprendizajes al finalizar el curso.

![Modelo de ciencia de datos de Hadley Wickham, Mine Ã‡etinkaya-Rundel y Garrett Grolemund. Traducido de https://r4ds.hadley.nz/intro#fig-ds-diagram](images/datascience.png){#fig-datascience}

En este curso no veremos ningÃºn dÃ­a modelizar (ya que hay un curso especÃ­fico programado para ello en junio de este aÃ±o), pero nos centraremos en la gestiÃ³n de datos, visualizaciÃ³n, trabajo en equipo y comunicaciÃ³n. Â¡Esperamos que os sea de utilidad!

## Estructura del curso

+------------------------------+-----------------------------------------------------------------------------------------------+
| DÃ­as de trabajo              | Contenido                                                                                     |
+==============================+===============================================================================================+
| **DÃ­a 1.** IntroducciÃ³n      | IntroducciÃ³n a la programaciÃ³n en R                                                           |
|                              |                                                                                               |
| Â¿QuÃ© necesitamos?            | Conceptos bÃ¡sicos, tipos de datos, consejos bÃ¡sicos de programaciÃ³n y definiciÃ³n de objetivos |
+------------------------------+-----------------------------------------------------------------------------------------------+
| **DÃ­a 2.** Organizando datos | Tidyverse                                                                                     |
|                              |                                                                                               |
| Â¿CÃ³mo lo organizamos?        | Importar, filtrar, seleccionar, transformar, unir y exportar datos                            |
|                              |                                                                                               |
|                              | Estructuras de programaciÃ³n                                                                   |
+------------------------------+-----------------------------------------------------------------------------------------------+
| **DÃ­a 3.** VisualizaciÃ³n     | IntroducciÃ³n a ggplot2                                                                        |
|                              |                                                                                               |
| Â¿CÃ³mo lo mostramos?          | Bases: grÃ¡ficos por capas unidimensionales y bidimensionales                                  |
|                              |                                                                                               |
|                              | VisualizaciÃ³n avanzada: personalizaciÃ³n y multipanel                                          |
+------------------------------+-----------------------------------------------------------------------------------------------+
| **DÃ­a 4.** ColaboraciÃ³n      | IntroducciÃ³n y flujo en Git y GitHub                                                          |
|                              |                                                                                               |
| Â¿CÃ³mo trabajamos en equipo?  | Trabajos colaborativos                                                                        |
+------------------------------+-----------------------------------------------------------------------------------------------+

**DÃ­a 5**

Informe en quarto donde presentÃ©is un objetivo a conseguir y desgraneis la descripciÃ³n de datos, manejo necesario y visualizaciÃ³n objetivo a travÃ©s de un repositorio de github compartido. Grupos de 2-3 personas.

9:00 a 11:00. Trabajo en grupo, resolver dudas.

11:30 a 14:00. PresentaciÃ³n en html generado a travÃ©s de quarto de 5-7 minutos.

**DinÃ¡mica del curso**

Cada dÃ­a combinaremos teorÃ­a con ejercicios. Idealmente, tendremos tiempo para que cada uno trabaje con sus propios datos. Todos los apuntes y ejercicios resueltos estarÃ¡n disponibles en el [repositorio de GitHub del curso](https://github.com/DatSciR/ciencia_datos).

Â¡asÃ­ aprenderemos entre todos! ğŸ˜‰

![El proceso de aprendizaje en R, por Allison Horst. https://allisonhorst.com/everything-else](images/e684f0da-13b1-4d00-ab25-37814e79ee1e.png){width="362"}

â¤ï¸ğŸ’œâ¤ï¸ğŸ’œ En el curso intentaremos dedicar al menos una hora al dÃ­a a vuestros trabajos, por lo que debÃ©is hacer grupos de dos-tres personas para programar. â¤ï¸ğŸ’œâ¤ï¸ğŸ’œ

**Antes de empezar. Estamos de acuerdo con el cÃ³digo Ã©tico y hacemos un ejemplo de este curso**

Lee: <https://www.contributor-covenant.org/version/2/0/code_of_conduct/> e informaciÃ³n sacada de <https://datasciencebox.org/>

![](images/data-science-box.png)

Usamos mucha bibliografÃ­a distinta para realizar este curso, pero os recomendamos los siguientes recursos:

[![\[R for data Science\](https://r4ds.hadley.nz/)](images/Wickham_RDataScience.jpg){fig-align="left" width="154"}](https://r4ds.hadley.nz/)

[![\[Advance R\](http://adv-r.had.co.nz/)](images/Wickham_AdvanceR.png){width="151"}](http://adv-r.had.co.nz/)

# Objetivos dÃ­a 1

-   Conceptos bÃ¡sicos de R (ğŸ“)

-   Consejos en la gestiÃ³n de datos y programaciÃ³n (ğŸ§‘â€ğŸ“ )

-   Tipos de objetos, indexaciÃ³n y exploraciÃ³n bÃ¡sica de datos con R base vs. Tidyverse

# Conceptos bÃ¡sicos ğŸ“

ğŸ¯ **R**: lenguaje de programaciÃ³n dinÃ¡mico (se interpreta el cÃ³digo en el momento que se ejecuta).

### ğŸ§© *Ejercicio Â¿EstÃ¡is de acuerdo con las siguientes afirmaciones?*

Â¿PodÃ©is en parejas encontrar aspectos por lo que estÃ©is de acuerdo o en desacuerdo con cadaafirmaciÃ³n? Â¿por quÃ© crees que es espacialmente importante usar R (u otro lenguaje de programaciÃ³n) en ciencia?

> R es un lenguaje de programaciÃ³n para el anÃ¡lisis estadÃ­stico.

Cumple con los siguientes aspectos:

-   CÃ³digo libre (gratuito)

-   Estado del arte

-   Flexible y potente

-   PortÃ¡til y replicable en otras plataformas

-   Ejemplos para â€œcasiâ€ cualquier anÃ¡lisis

-   Por y para la comunidad

> RStudio es lo mismo que R

ğŸ¯ **RStudio**: entorno de desarrollo integrado para programar en R (IDE: Integrated Development Environemnt). Tiene cuatro zonas diferenciadas: el editor de cÃ³digo, la consola (donde se ejecuta el cÃ³digo), el navegador del espacio de trabajo (con el entorno â€“*environment-* y el historial de comandos) y el mix de abajo a la derecha (Archivos, GrÃ¡ficos, Paquetes, Ayuda).

![](images/Rstudio_entorno.png)

ğŸ¯ **Objetos**: cualquier elemento almacenado con un nombre especÃ­fico. Pueden ser de muchos tipos: `numeric`, `integer`, `logical`, `data.frame`, `SpatVector`, etc.

El operador ":" genera un grupo de nÃºmeros enteros:

```{r}
1:6
c(1, 2, 3, 4, 5, 6)
```

Ahora mismo hemos generado un grupo de seis nÃºmero de enteros, pero no se han guardado en ningÃºn sitio en la memoria del ordenador. Si quieres usar este vector de nuevo, debes guardarlo, creando un objeto en R, para ello debes usar la flecha de asignaciÃ³n \<-.

```{r}
mi_vector <- 1:6 #con la flecha de asignaciÃ³n lo guardo como un objeto R
mi_vector <- c(1, 2, 3, 4, 5, 6) #pero no lo tengo guardado en mi carpeta
str(mi_vector) #podemos ver la estructura del vector
class(mi_vector)
summary(mi_vector) #y unas estadisticas bÃ¡sicas
```

Un tipo de objeto con el que vamos a trabajar es un data.frame que es una tabla donde las filas son las observaciones y las columnas son las variables. En concreto, todos los dÃ­as vamos a trabajar con la tabla de **palmer_penguins**.

![](images/palmer_penguins.png)

+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Los datos de **palmer penguins** fueron recopilados y puestos a disposiciÃ³n por la Dra. Kristen Gorman y la EstaciÃ³n Palmer, LTER de la AntÃ¡rtida, miembro de la Red de InvestigaciÃ³n EcolÃ³gica a Largo Plazo. Datos de pinguinos adultos de tres especies diferentes y de tres islas diferentes e incluye informaciÂ´n sonbre tamaÃ±o y sexo. |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

```{r}
library(palmerpenguins)
library(tidyverse)
data(penguins)
str(penguins) #permite ver la estructura de los datos
glimpse(penguins) #permite ver la estructura de los datos, mÃ¡s organizada
summary(penguins)
```

ğŸ¯ **Funciones**: objetos de R que toman un vector de entrada y dan como resultado otro vector haciendo una acciÃ³n concreta (funcionalidad especÃ­fica). Son los *bloques de construcciÃ³n* fundamentales en cualquier script de R que es un lenguaje funcional.

Las funciones usan argumentos, y generalmente tienen elementos de entrada y salida que se transforman de una manera especÃ­fica.

### ğŸ§© *Ejercicio Â¿Ves alguna funciÃ³n especifica en el "chunk" mÃ¡s arriba?*

Los **paquetes o librerias** contienen funciones reutilizables, documentaciÃ³n sobre cÃ³mo usarlas y datos de ejemplo. Son las unidades fundamentales de cÃ³digo reproducible en R. La primera vez que necesitas un paquete o librerÃ­a lo instalas, la segunda lo cargas en tu sesiÃ³n de trabajo, con las funciones `install.packages()`, `library()`.

> Para comprender la programaciÃ³n en R, resultan Ãºtiles dos lemas:
>
> \- Todo lo que existe es un objeto.
>
> \- Todo lo que sucede es una llamada a funciÃ³n.
>
> â€” John Chambers ([Advanced R](https://adv-r.hadley.nz/index.html))

## Consejos para la gestiÃ³n de datos y programaciÃ³n

### Trabaja siempre por proyectos

El directorio de trabajo es la carpeta de nuestro ordenador donde estamos trabajando. El script es el archivo bÃ¡sico que almacena cÃ³digo de R de nuestra sesiÃ³n de trabajo.

*Â¡En este curso debes usar las TECLAS RÃPIDAS para programar!*

``` r
getwd() # saber directorio de trabajo 
setwd("C:/Users/uah/OneDrive - Universidad de Alcala/GitHub_Projects/ciencia_datos_uah") # ojo con la ruta / o \\
```

â„¹ï¸ **InformaciÃ³n importante**

Cuando ejecutes un comando en RStudio, recuerda que el resultado aparece inmediatamente en la consola.

No es recomendable establecer el directorio de trabajo manualmente porque el trabajo deja de ser reproducible. Es mejor crear desde el principio un **proyecto en R** ligado a un directorio relativo que contenga todos los datos de entrada, los scripts y los resultados del script. Al abrir el proyecto, se sincroniza con pestaÃ±a Files.

ğŸ’¡Para crear un proyecto: Archivo \> Nuevo proyecto.

### ğŸ§© *Ejercicio*

Crea un proyecto para el Curso: **proyecto_doctorado_UAH_R** y un proyecto del cuaderno de clase **cuaderno_doctorado_UAH_R** Una vez creado genera una carpeta de "scripts" y una de "resultados". Revisa en tu panel de Rstudio a la derecha, abajo, que archivos tienes. Â¿CÃ³mo has nombrado tu archivo de trabajo actual? Â¡Revisa y cambia el nombre al final de la sesiÃ³n!

Normalmente, para trabajar adecuadamente debemos organizar las carpetas y los nombres de los archivos con los que trabajamos Â¿CÃ³mo lo hacÃ©is habitualmente?

AdemÃ¡s de un archivo ".README" que explique la organizaciÃ³n del trabajo, podÃ©is especificar archivos de entrada, salida, scripts o procesos.

### Usa teclas rÃ¡pidas y comenta tu cÃ³digo

Utiliza comentarios para guiar al lector con `#`, acordarte por quÃ© hiciste un determinado cÃ³digo, o ayudar a otra persona a entender tu cÃ³digo sin necesitar que tu se lo expliques (o a ti mismo dentro de un tiempo...) Â¡un cÃ³digo buen comentado te ahorrarÃ¡ mucho tiempo!

ğŸ’¡Para ejecutar una lÃ­nea de cÃ³digo usa el comando: *Ctrl + Enter (Ctrl + R)*

*Â¡No tienes que seleccionar con el ratÃ³n la lÃ­nea de ejecutar y darle a "Run"! con las techas de mÃ¡s arriba e incluso shift te ahorrara tiempo!*

### Aprende a pedir ayuda, conoce las funciones y argumentos

Dentro de los paquetes puedes pedir ayuda de multiples maneras.

``` r
# install.packages("tidyverse", dep = T) # dep = T significa instalar dependencias

library(tidyverse)

install.packages(c("swirl", "swirlify"))
library(swirlify)
```

### ğŸ§© *Ejercicio*

Â¿puedes buscar ayuda sobre quÃ© es el paquete tidyverse y quÃ© hace? Â¿puedes buscar ayuda sobre la funciÃ³n "select"?

``` r
?tidyverse
```

``` r
?select
```

### MantÃ©n el cÃ³digo reproducible

![[The Reproducibility process](https://the-turing-way.netlify.app/reproducible-research/overview/overview-definitions.html#rr-overview-definitions). [The Turing Way Community (2025)](https://doi.org/10.5281/ZENODO.3233853).](images/evolution-openscien.png)

### ğŸ§© *Ejercicio*

Aprende sobre reproducibilidad, ya que es clave y fundamental en ciencia. Lee el [siguiente](https://book.the-turing-way.org/reproducible-research/overview/overview-definitions/) enlace y discute

-   Â¿es realmente todo lo que haces reproducible? Â¿haces algÃºn aspecto del proceso de publicaciÃ³n reproducible?

-   Â¿sabes identificar por quÃ©?

-   Â¿que ventajas y desventajas tiene hacerlo reproducible?

**Discutelo en parejas.**

AquÃ­ os dejamos algunas de las ventajas de la reproducibildiad y porquÃ© debe implementarse en los equipos de trabajo.

![Ventajas de la reproducibilidad. The Turing Way Community (2025).](images/reasons-reproducibil.png)

### Nombra objetos y archivos adecuadamente

![](images/Importance-style-guide.png)

### Nombrar objetos y archivos

Al asignar un nombre a un objeto podemos llamarlos siempre que necesitemos a lo largo del script. No es necesario guardar (exportar) la mayorÃ­a de los objetos que tenemos en el entorno de trabajo de R a nuestro ordenador, lo importante es conservar el script con el que se generan.

### ğŸ§© *Ejercicio*

Â¿Es lo mismo nombrar a un objeto "x" o "X"?Â¿Crees que te puede dar problemas en el cÃ³digo nombrar variables con mayÃºsculas y minÃºsculas? Para verlo, nombra dos objetos

```{r}
x <- 4.5 
X <- "objeto" # si el objeto contiene letras, usar comillas 
class(x) # funciÃ³n para ver de que clase es nuestro objeto 
```

ğŸ“R es sensible a las mayÃºsculas. Mejor no usarlas.

ğŸ“Los nombre de los objetos deben ser descriptivos y no deben contener sÃ­mbolos especiales. Es mejor usar nombres largos pero descriptivos, que cortos o sin sentido. ExcepciÃ³n: para archivos temporales yo generalmente uso "kk" que me recuerda a recordar que este archivo es temporal y prescindible...

![](images/FINALdoc.png)

> Hay dos cosas difÃ­ciles en la Ciencia de ComputaciÃ³n:
>
> \- Invalidar cachÃ©s.
>
> \- Poner nombres a cosas
>
> â€” Phil Carton

ğŸ“Usa nombre memorables y correctos para tus variables:

âœ… Siempre empiezan por letras (en el caso de objetos)

âœ… Solo pueden contener letras, numeros, "\_" y ".".

âœ… Los nombres deben ser legibles por mÃ¡quinas: No uses espacios, caracteres especiales o palabras reservadas.: (`^`, `!`, `$`, `@`, `+`, `-`, `/`, `*`).

âœ… Usa minÃºsculas separadas por "\_"

âœ… Los nombres deben ser legibles para humanos: describen lo que continene. Para variables usa nombres y para funciones verbos.

âœ… Evita el uso de nombres comunes Object names must start with a letter and can only contain letters, numbers, \_, and ..

ğŸ’¡ Numerar los scripts e incluso las salidas (tablas, figuras, etc.) ayuda a simplificar el orden y trabajar comodamente mediante proyectos.

### ğŸ§© *Ejercicio*

Lee la guÃ­a de estilo de tidyverse (con la que trabajaremos en el curso):

-   SecciÃ³n 2.2.: <https://r4ds.hadley.nz/workflow-style.html>

-   SecciÃ³n 4.1. y 4.2.: <https://style.tidyverse.org/syntax.html>

Revisa cÃ³mo nombras a las tablas y las variables con las que trabajas:

-   Â¿siguen un buen estilo a la hora de nombrarlas?

-   Â¿trabajas en proyectos y tienes todo ordenado adecuadamente?

-   

## Tipos de objetos, exploraciÃ³n bÃ¡sica de datos e indexaciÃ³n con R base vs. Tidyverse

En R, el cÃ³digo que tecleas se llama **comando**. La interfaz de Rstudio es sencilla, cuando en el ***prompt*** de la consola de RStudio ejecutas una lÃ­nea de comando da instrucciones al ordenador para hacer la operaciÃ³n escrita. Puedes usar R como una calculadora, usando operadores matemÃ¡ticos, relacionales o lÃ³gicos, que son:

![](images/Operadores.png)

### Tipos de objetos

ğŸ¯ Un **vector** es la estructura de datos mÃ¡s simple en R. Es una colecciÃ³n de uno o mÃ¡s elementos del mismo tipo (nÃºmeros, texto o valores lÃ³gicos).

*Â¿QuÃ© tipos de datos puede contener un vector?*

Si tu dato es numerico, puede ser discreto (int) o continue (num)

![](images/continuous_discrete_allinson) [Imagen de Allson Horst](https://allisonhorst.com/everything-else)

ğŸ§  *Â¿Existe algÃºn otro tipo de dato nÃºmerico?*

âš ï¸ *Â¿son todos los tipos de datos categÃ³ricos iguales?*

![](images/nominal_ordinal_Allinson) [Imagen de Allson Horst](https://allisonhorst.com/everything-else)

usar funciones bÃ¡sicas como `mean()`, `min()`, `max()`.

ğŸ¯ Las **matrices** son datos bidimensionales que contienen datos del mismo tipo.

ğŸ¯ Una **lista** puede contener objetos heterogÃ©neos: vectores, matrices, data.frames, modelos, etc.

ğŸ¯ Un **data.frame** es una tabla (2D) donde cada columna puede ser de distinto tipo. Es la estructura mÃ¡s usada para anÃ¡lisis y la que normalmente acompaÃ±a a una capa espacial (atributos).

### ğŸ§© *Ejercicio*

-   Crea un vector usando tu "chuleta" r-base y probando que al menos que tenga una longitud de la base de datos penguins. Puedes usar las opciones: c(), seq(). Genera un vector tipo fecha.
-   Genera un vector tipo factor nominal, ordinal y binario. Puedes usar la funciÃ³n tipo rep().
-   Une todos los vectores en un data frame.

### ExploraciÃ³n bÃ¡sica de datos

Cuando trabajamos con un data.frame o cualquier otro objeto, lo primero que debemos conocer es su estructura: nÃºmero de observaciones o filas, nÃºmero de columnas o variables, tipo de dato (nÃºmerico o carÃ¡cter, y de quÃ© tipo).

Lo siguiente que debemos conocer son las caracterÃ­sticas bÃ¡sicas Â¿conoces tus datos?. Intenta si puedes reponder a estas preguntas bÃ¡sicas de la variable de interÃ©s:

-   Â¿medidas de centralidad (e.g. media, moda, mediana)?

-   Â¿y medidas de dispersiÃ³n (rangos, percentiles, valores anÃ³males, desviaciÃ³n estandar y error estÃ¡ndar?

-   Â¿varian por ciertos niveles del factor (e.g. Â¿especie de pingÃ¼ino?).

-   Â¿Tienes ceros o valores nulos entus datos? Â¿Por quÃ©?

### ğŸ§© *Ejercicio*

Realiza las estadÃ­sticas bÃ¡sicas de los datos de **penguins** con summary. Selecciona una variable, por ejemplo, la longitud del pico y genera un nuevo vector donde reemplaces tres datos por valores extremos.

Â¿Es la media suficiente para conocer la distribuciÃ³n de los datos? Â¿quÃ© informaciÃ³n te dan los extremos?

Â¿QuÃ© grÃ¡ficos bÃ¡sicos existen para conocer la centralidad y la variabilidad de los datos? Si hacÃ©is el curso de estadÃ­stica esto lo llamamos ExploraciÃ³n BÃ¡sica de Datos y es la base central de caulquier anÃ¡lisis, que requieren de una buena base teÃ³rica y una buena exploraciÃ³n y conocimiento de los datos.

![](images/summary_statistics)

[Imagen de Allson Horst](https://allisonhorst.com/everything-else)

### IndexaciÃ³n y exploraciÃ³n bÃ¡sica de datos con Rbase y tidyverse. Uso de la pipa

`Rbase` es el paquete que viene en R por defecto, mientras que `tidyverse` es un conjunto de paquetes de R para ciencia de datos. Todos los paquetes tienen una misma estructura (filosofÃ­a, gramÃ¡tica y estructura de datos).

![<https://tidyverse.org/>](images/tidyverse_packages.png)

Se basa en los siguientes principios:

-   **Centrado en humanos**: tiene un diseÃ±o intuitivo que facilita su uso y accesibilidad para el usuario

-   **Consistencia**: todos los paquetes estÃ¡n diseÃ±ados para trabajar con datos ordenados (â€œTidy Dataâ€), y las funciones de los paquetes tienen una nomenclatura comÃºn y congruente. Esto permite que un usuario que aprende sobre una funciÃ³n o paquete pueda aplicar ese conocimiento a otros, facilitando asÃ­ la tarea de recordar y deducir cÃ³digo de manera mÃ¡s sencilla.

-   **Componiblidad**: permite al usuario resolver problemas complejos dividiÃ©ndolos en pequeÃ±as partes, que pueden combinarse utilizando el operador â€œpipeâ€ (`%>%` or `|>)`.

-   **Inclusividad**: no se trata sÃ³lo de la colecciÃ³n de paquetes, sino tambiÃ©n la comunidad de personas que los usan, basÃ¡ndose en la ayuda entre usuarios y generando un ambiente inclusivo.

### Datos ordenados o tidy data

ğŸ’¡ Cuando trabajamos con datos tipo "data.frame" fila es una *observaciÃ³n"* y cada columna es una "*variable*. Esto parece sencillo, pero *Â¿realmente ocurre asÃ­?* primero asegurate de la estructura de tus datos, que la comprendes e intenta trabajar con tidy data.

![](images/clipboard-2935155425.png)

Esto facilita el anÃ¡lisis, la manipulaciÃ³n y la visualizaciÃ³n de datos. Esto lo explican muy bien con una serie de ilustraciones Julia Lowndes y Allison Horst en ["Tidy data for efficiency, reproducibility, and collaboration"](https://openscapes.org/blog/2020-10-12-tidy-data/)

![](images/tidydata_2.png)

Usando este estÃ¡ndar se consigue que todos los set de datos tengan la misma estructura.

![](images/tidydata_3.png)

Trabajar con tidy data es mÃ¡s eficiente, permite la colaboraciÃ³n, la reproducibilidad y la reutilizaciÃ³n de cÃ³digo.

ğŸ“ En esta secciÃ³n vamos a comparar dos operaciones muy comunes en manipulaciÃ³n de datos, ademÃ¡s de hacer estadisticas bÃ¡sicas

-   `select()` para **elegir columnas**\
-   `filter()` para **elegir filas**

Primero veremos cÃ³mo se hacen en **base R** y luego con el **tidyverse**. Usaremos el dataset incorporado en R llamado `penguins`,

**Nuestro objetivo:** seleccionar la especie que tiene un mayor peso corporal para los machos. Para lo que:

1.  Conocemos los datos

2.  Seleccionamos variables de interÃ©s

3.  Filtramos los machos

4.  Los colocamos en orden descendiente

5.  Mostramos los resultados: nuestro primer grÃ¡fico

#### 1. Conoce tus datos para una pregunta concreta

```{r}

#### readr (read rectangular data) ####
str(penguins)    
glimpse(penguins)   
head(penguins)      
tail(penguins)      
summary(penguins)  
names(penguins)     
dim(penguins)        
nrow(penguins)       
ncol(penguins)      
```

#### Ejercicio ğŸ§©

Piensa y escribe en una lÃ­nea quÃ© hace cada funciÃ³n y discutelo con el compaÃ±ero. Â¿Hay algÃºn dato extraÃ±o? Â¿Hay que tomar alguna decisiÃ³n?

#### 2. SelecciÃ³n de variables de interÃ©s: Rbase vs. tidyverse

#### Queremos seleccionar las variables `body_mass_g` (peso corporal) y `species` (especie), ademÃ¡s del `sex` (gÃ©nero).

### Con Base R

```{r}
penguins_rbase1 <- penguins[, c("species", "body_mass_g", "sex")]
penguins_rbase2 <- penguins[, c(1, 6, 7)]
```

### Con tidyverse (`select()`)

```{r}
penguins_tidy <- penguins |>
  select(species, body_mass_g, sex)
```

Para comprender lo que hacemos tenemos que usar la pipa:

![](images/pipa.png)

no hace mÃ¡s que lo siguiente, pero ayuda a mucho a comprender y sintetizar cÃ³digo, porque Â¿en quÃ© sentido hablamos los humanos?

![](images/funcionamiento_pipa.png)

#### ğŸ§© Ejercicio

*Diferencias entre Rbase y tidyverse.* Â¿QuÃ© es mÃ¡s sencillo de entender? Â¿y mÃ¡s reproducible de las tres opciones que hemos visto?

------------------------------------------------------------------------

#### . Filtramos los machos

Queremos quedarnos solo con los machos

### Con Base R

```{r}
select_penguins_filtrado <- penguins_rbase1[penguins_rbase1$sex == "male", ]
```

### Con tidyverse (`filter()`)

```{r}
select_penguins_filtrado <- filter(penguins_rbase1, sex == "male")

select_penguins_filtrado <- penguins_rbase1 |>
  filter(sex == "male")
```

------------------------------------------------------------------------

#### 4. Lo colocamos en orden descendiente, combinando operaciones

### Con tidyverse (piping)

```{r}
penguins_male_body_kg <- penguins |>
  select(species, body_mass_g, sex) |>
  filter(sex == "male") |> 
  mutate(body_mass_kg = body_mass_g / 1000)|> 
  arrange(body_mass_kg) 
```

ğŸ‘‰ Ventajas: mÃ¡s intuitivo, cada paso es claro y en â€œlenguaje naturalâ€. ğŸ‘‰ Inconvenientes: requiere instalar/cargar dplyr.

### Con Rbase (piping)

```{r}
#sin pipa
penguins_rbase1 <- penguins[penguins_rbase1$sex == "male", c("species", "body_mass_g", "sex")]
penguins_rbase1$body_mass_kg <- penguins_rbase1$body_mass_g / 1000
penguins_sorted <- penguins_rbase1[order(penguins_rbase1$body_mass_kg), ]


```

ğŸ‘‰ Ventajas: usa solo R base, no necesita librerÃ­as adicionales. ğŸ‘‰ Inconvenientes: la sintaxis es mÃ¡s dificil para alumnos principiantes, menos legible.

#### 5. Mostramos los resultados: nuestro primer grÃ¡fico

GrÃ¡fico base R

```{r}
plot(penguins_male_body_kg$species, penguins_male_body_kg$body_mass_kg,
     main = "",
     xlab = "species", 
     ylab = "body mass (kg)",
     pch = 19, col = "blue")
```

GrÃ¡fico con ggplot2, paquete de grÃ¡ficos de tidyverse

```{r}
ggplot(penguins_male_body_kg, aes(x = species, y = body_mass_kg)) +
  geom_boxplot(color = "darkred", size = 0.5) +
  labs(title = "body mass ~ species (tidyverse)",
       x = "species",
       y = "body mass (kg)") +
  theme_minimal()
```

------------------------------------------------------------------------

#### ğŸ§© Ejercicio

Ahora es vuestro turno ğŸ’¡, practica la seleccion y filtrado con la pipa.

1.  **Ejercicio 1:** Selecciona solo las columnas `bill_length_mm` y `bill_depth_mm` de `penguins` usando tanto base R como tidyverse.\
2.  **Ejercicio 2:** Filtra los individuos que tengan un body_mass_kg mayor de 3,5 . Calcula la media de la longitud y profundidadd del pico.\
3.  **Ejercicio 3 (reto):** Usando tidyverse, selecciona todas las columnas numÃ©ricas, y quÃ©date solo con los individuos de la especie Adelie de sexo femenino. Calcula la media, y rangos (mÃ­nimo, mÃ¡ximo).

![](images/R_heart.gif)

#### ğŸ§© Trabajos con vuestros datos y proyecto

Piensa en el modelo de ciencia de datos que hemos visto al principio del dÃ­a:

![Modelo de ciencia de datos de Hadley Wickham, Mine Ã‡etinkaya-Rundel y Garrett Grolemund. Traducido de https://r4ds.hadley.nz/intro#fig-ds-diagram](images/datascience.png)

**Plantea el objetivo de vuestro trabajo**

-   Â¿quÃ© variables usÃ¡is y como son vuestros datos?

-   Â¿puedes describir el data.frame que impartas y responder a las siguientes preguntas?:

    -   Â¿Son vuestros datos tidy? Â¿QuÃ© representa cada fila y quÃ© cada columna? Especifica el nÃºmero de filas y columnas. Ten claro y documenta cÃ³mo has llegado a ello, siempre es recomendable tener unos metadatos con una descripciÃ³n de los datos, obtenciÃ³n, fuentes y unidades.

    -   Â¿QuÃ© tipo de datos y caracteristicas tiene cada columna? Revisa para las numericas las medidas de centralidad y de dispersiÃ³n: Â¿tienen sentido los valores? Â¿tienes datos anomalos? Â¿tienes muchos ceros o NAs y que significan?

    -   Revisa el tipo de datos tipo caracter que que significan, Â¿son de tipo nominal, ordinal o binario?Â¿puedes comprobar los niveles de las variables seleccionadas?

-   Revisa que tipo de grÃ¡fico te gustarÃ­a visualizar al terminar el curso. MaÃ±ana verÃ©is las operaciones que podÃ©is / tenÃ©is que realizar para ello, y el miÃ©rcoles cÃ³mo realizar la visualizaciÃ³n, pero es conveneinte que tengÃ¡is una idea de QUÃ‰ QUEREIS HACER, y es muy importante saberlo ANTES de programar.
