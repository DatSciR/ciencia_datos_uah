---
title: "DÃ­a 2 - Manejo de datos con Tidyverse. Programa de doctorado UAH"
author: "Marina Rodes Blanco, Paloma Ruiz Benito, VerÃ³nica Cruz Alonso y JuliÃ¡n Tijerin TriviÃ±o"
date: today
date-format: "DD/MM/YYYY"
toc: true
toc-depth: 5
toc-title: "Ãndice"
format:
  html:
    link-external-newwindow: true
    # css: styles.css
  gfm: default
editor: visual
editor_options: 
  chunk_output_type: console
number-sections: false
---

## SÃ­ntesis del dÃ­a 1: IntroducciÃ³n a R y a R studio (POR TERMINAR)

#### ğŸ§© Ejercicio: *repaso* *del dÃ­a anterior*

-   Crea un vector con los meses del aÃ±o (en nÃºmero) y calcula la media
-   Crea una matriz ... Â¿Cual es el elemento de la fila 3 columna 2?
-   Crea una lista .. Â¿Que hay en el tercer elemento de la lista?
-   Crea un data frame con la siguiente informaciÃ³n

```{r solucion ej repaso}
#Pendiente
```

## Importar y renombrar datos

#### ğŸ§© *Ejercicio: slice(), filter(), arrange()*

```{=html}
<table>
  <tr>
    <td style="width:330px; vertical-align:top;">
      <img src="images/mammals_sleeping_picture1_copilot.png" style="width:300px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
      <li> Lee el data.frame â€œmsleep.csvâ€. Pista: el delimitador entre datos es la coma (â€œ,â€).</li>
      <li> Crea un subset que NO contenga los animales domÃ©sticos (campo conservation). Â¿Cuantas son?</li>
      <li> Crea un subset de datos que contenga las filas de la 1 a la 5 y de la 18 a la 20, sobre esos datos obten los animales carnÃ­voros. Ordena segÃºn las horas de sueÃ±o Â¿QuÃ© animal duerme mÃ¡s horas?</li>
    </td>
  </tr>
</table>
```

```{r solucion ejercicio 1}
#SoluciÃ³n ejercicio 1: slice(), filter(), arrange()
library (tidyverse)

## Leer el data frame
msleep<- read_delim(file = "data/msleep.csv", delim = ",")

head(msleep)

## Crea un subset que NO contenga los animales domÃ©sticos (campo conservation). Â¿Cuantas son?

msleep |>  filter(conservation != "domesticated")

#### Otras posibles soluciones...
msleep |>  filter(conservation %in% c("lc", "nt", "vu", "en", "cd",NA))
msleep |>  filter(conservation == "lc" | conservation =="nt" | 
                    conservation == "vu"|conservation == "en"|
                    conservation == "cd"| is.na(conservation))

## Crea un subset de datos que contenga las filas de la 1 a la 5 y de la 18 a la 20, sobre esos datos obten los animales carnÃ­voros. Ordena segÃºn las horas de sueÃ±o Â¿QuÃ© animal duerme mÃ¡s horas?

subset_msleep<- msleep |> 
  slice(1:5, 18:20) |>
  filter(vore=="carni") |> 
  arrange(desc(sleep_total))
  
#### solucion: Cheetah (guepardo)

```

### [Select](https://dplyr.tidyverse.org/reference/select.html): sirve para seleccionar columnas utilizando condiciones

#### ğŸ§© *Ejercicio: select()*

```{=html}
<table>
  <tr>
    <td style="width:330px; vertical-align:top;">
      <img src="images/mammals_sleeping_picture2_copilot.png" style="width:300px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
      <li> Con el data set de msleep, crea un nuevo data.frame que contenga las variables relacionadas con el sueÃ±o.</li>
      <li> Crea un nuevo objeto con el orden, gÃ©nero y nombre al principio y que incluya todas las demÃ¡s columnas excepto el tiempo despierto.</li>
      <li>(extra) Â¿Que animal del orden Carnivora en estado vulnerable (conservation = vu) duerme mÃ¡s?</li>
    </td>
  </tr>
</table>
```

```{r solucion ejercicio 2}

## Nuevo data.frame que contenga las variables relacionadas con el sueÃ±o
head(msleep) #para ver las 10 primeras lineas
names(msleep) #para ver el nombre de las columnas

vars_sleep<-msleep |>  select(starts_with("sleep"))

## Nuevo objeto con el orden, gÃ©nero y nombre al principio y que incluya todas las demÃ¡s columnas excepto el tiempo despierto.
msleep2<- msleep |>  select(order, genus, name, everything(), -awake)

## Extra: Â¿Que animal del orden Carnivora en estado vulnerable (conservation = vu) duerme mÃ¡s?

msleep |>  filter(order=="Carnivora" & conservation =="vu") |>  arrange(desc(sleep_total))

```

## Transformar los datos y calcular nuevas variables

#### ğŸ§© *Ejercicio: mutate()*

```{=html}

<table>
  <tr>
    <td style="width:330px; vertical-align:top;">
      <img src="images/mammals_sleeping_picture3_copilot.png" style="width:300px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
      <li> Con el data set de msleep, incluye una nueva columna con el porcentaje de horas que duerme cada animal al dÃ­a. </li>
      <li> Haz una clasificaciÃ³n que incluya tres categorÃ­as: carnivoros amenazados, herviboros amenazados y otros. Para ello tienes que basarte en las columnas â€œvoreâ€ y â€œconservationâ€. Segun la UICN se considera amenazado cuando estÃ¡ en las categorÃ­as vulnerable (vu), endangered (en) o critically endangered (cr). </li>
    </td>
  </tr>
</table>
```

```{r solucion ejercicio 3}
## Nueva columna con el porcentaje de horas que duerme cada animal al dÃ­a.

## Haz una clasificaciÃ³n que incluya tres categorÃ­as: carnivoros amenazados, herviboros amenazados y otros. Para ello tienes que basarte en las columnas â€œvoreâ€ y â€œconservationâ€. Segun la UICN se considera amenazado cuando estÃ¡ en las categorÃ­as vulnerable (vu), endangered (en) o critically endangered (cr).

```

#### ğŸ§© *Ejercicio: group_by(), summrise()*

```{=html}
<table>
  <tr>
    <td style="width:330px; vertical-align:top;">
      <img src="images/mammals_sleeping_picture4_copilot.png" style="width:300px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
      <li> Con el data set de msleep, cuenta el nÃºmero de especies estudiadas por orden (order) </li>
      <li> Calcula el promedio de horas de sueÃ±o segÃºn el tipo de alimentaciÃ³n Â¿duemen mas los carnivoros, los herbÃ­voros o los insectÃ­voros estudiados en este dataset? </li>
    </td>
  </tr>
</table>
```

```{r solucion ejercicio 4}

```

#### ğŸ§© *Ejercicio: transformar datos largo ancho*

```{=html}
<table>
  <tr>
    <td style="width:330px; vertical-align:top;">
      <img src="images/pixar_image2_flickr.jpg" style="width:300px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
      <li> Lee el set de datos pixar_public_response_long. En este set de datos se encuentra la puntuaciÃ³n de pelÃ­culas pixar por la audiencia segÃºn tres webs diferentes: rotten tomatoes, metacritic y criticsâ€™ choice. </li>
      <li> Reorganiza el set de datos para que la puntuaciÃ³n de cada una de las webs se encuentre en una columna diferente </li>
      <li> (extra) Â¿Cual es el promedio de puntuaciÃ³n por pelÃ­cula teniendo en cuenta todas las fuentes? Â¿Que pelÃ­cula es la mejor y peor puntuada de media? </li>
    </td>
  </tr>
</table>
```

Fuente imagen: <https://www.flickr.com/photos/harshlight/17294952412> (CC BY 2.0)

```{r solucion ejercicio 5}

```

## Unir data.frames

#### ğŸ§© *Ejercicio: \*\_join() y exportar datos*

```{=html}
<table>
  <tr>
    <td style="width:330px; vertical-align:top;">
      <img src="images/pixar_image3_flickr.jpg" style="width:300px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
      <li> Lee el set de datos pixar_public_response y pixar_films </li>
      <li> Explora los dos data sets con funciones como head() para ver las primeras lineas, glimpse() o View() </li>
      <li> Une ambos datasets en uno solo para tener en un mismo data frame toda la informaciÃ³n. Elige el campo mÃ¡s apropiado de uniÃ³n </li>
      <li> Guarda el nuevo set de datos como pixar_joint </li>
    </td>
  </tr>
</table>
```

Fuente imagen: <https://www.flickr.com/photos/harshlight/6988729286> (CC BY 2.0)

```{r solucion ejercicio 6}

```

## ğŸ§© *Ejercicio final*

```{=html}
<table>
  <tr>
    <td style="width:150px; vertical-align:top;">
      <img src="images/palmer_penguins.png" style="width:130px; height:auto; display:block;">
    </td>
    <td style="vertical-align:middle;">
    Queremos estudiar caracterÃ­sticas fÃ­sicas de los pingÃ¼inos y relacionarlas con el tipo de isla donde viven. Para ello, realiza las siguientes tareas utilizando exclusivamente funciones del tidyverse:
    </td>
  </tr>
</table>
```

ğŸ§ Instala el paquete penguins y cÃ¡rgalo

ğŸ§ Crea un data frame con dos columnas, la primera denominada "islands_info" con los valores "Torgersen", "Biscoe", "Dream" y otra llamada "protected_area" con los valores "Si", "No", "Si"

ğŸ§Selecciona los pinguinos que tengan picos de mÃ¡s de 40mm (bill_len) y que pesen menos de 4.5kg (recuerda que puedes ver mÃ¡s informaciÃ³n de tu dataset en ?penguins)

ğŸ§De los datos filtrados conserva Ãºnicamente las columnas species, island, bill_length, bill_depth y body_mass

ğŸ§AÃ±ade una columna llamada bill_ratio que calcule la relaciÃ³n entre longitud y profundidad del pico

ğŸ§Une el resultado con el dataset islands \_info, de forma que cada pingÃ¼ino quede asociado a si su isla es un Ã¡rea protegida.

ğŸ§Crea una columna categoria_peso con valores "ligero", "medio", "pesado"segÃºn los umbrales que quieras o, mÃ¡s dificil, con terciles de body_mass.

ğŸ§Cuenta cuantos individuos hay ligeros, medios y pesados en zonas protegidas vs zonas no protegidas

ğŸ§(EXTRA) Responde a las siguientes preguntas: Â¿Cual es la mÃ¡xima relaciÃ³n entre longitud y profundidad del pico de los individuos en zonas protegidas? Â¿y no protegidas? Â¿Cuanto pesa el individuo mÃ¡s pesado?

```{r solucion ejercicio final}

```

------------------------------------------------------------------------

<details>

<summary>Session Info</summary>

```{r session_info}
Sys.time()
sessionInfo()
```

</details>
