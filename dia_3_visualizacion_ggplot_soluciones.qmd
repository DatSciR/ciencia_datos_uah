---
title: "dia_3_visualizacion_ggplot_soluciones"
format: html
editor: visual
---

## 

## Soluciones a los ejercicios:

```{r ejecicio a}

# Dimensiones del dataset 
dim(penguins)  

# Estructura de las variables 
str(penguins)  

# Número de valores NA por variable 
colSums(is.na(penguins))
```

```{r ejecicio b}

# Número de individuos por especie 
ggplot(penguins, aes(x = species)) +   
  geom_bar()   

# Número de individuos por isla 
ggplot(penguins, aes(x = island)) +   
  geom_bar() 

# Distribución del peso
ggplot(penguins, aes(x = body_mass_g)) +
  geom_histogram()
```

```{r ejercico c}

ggplot(
  penguins,
  aes(
    x = flipper_length_mm,
    y = body_mass_g,
    color = species,
    shape = sex,
    size = year,
    alpha = year
  )
) +
  geom_point()  
```

```{r ejercicio d}
ggsave(
  filename = "grafico_publicacion.jpg",
  plot = p,
  width = 7,
  height = 5,
  units = "in",
  dpi = 300
)

ggsave(
  filename = "grafico_presentacion.jpg",
  plot = p,
  width = 10,
  height = 6,
  units = "cm",
  dpi = 150
)
#(Nota: p corresponde al gráfico creado previamente.)
```

```{r ejercicio e}

# Gráfico 1 – Color mapeado a una variable, tamaño fijo  
a1 <- ggplot(penguins) +   
  geom_point(aes(x = body_mass_g, y = bill_depth_mm, color = species), size = 2,     alpha = 0.7   )  
#✔ color está dentro de aes() → representa información #✔ size y alpha están fuera → valores constantes 
#✔ ggplot crea una leyenda de color  

# Gráfico 2 – Color fijo, tamaño mapeado a una variable  
a2 <- ggplot(penguins) +   
  geom_point(aes(x = body_mass_g, y = bill_depth_mm, size = body_mass_g), color = "darkblue", alpha = 0.7)  
#✔ size está dentro de aes() → varía según los datos 
#✔ color está fuera → mismo color para todos los puntos 
#✔ ggplot crea una leyenda de tamaño  
```

```{r ejercicio f}

# 1a y 1b: Bar plot con proporciones y conteos 
a1 <- ggplot(penguins, aes(x = species, fill = sex)) +   
  geom_bar(position = "fill")  

# proporciones  
a2 <- ggplot(penguins, aes(x = species, fill = sex)) +   
  geom_bar(position = "dodge")  

# conteos por sexo  
# 2a-c: Scatterplot con color, tamaño y transparencia 
a3 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm,                       color = species, size = body_mass_g)) +   
  geom_point(alpha = 0.6)
```

```{r ejercicio g}
# 1. Boxplot con etiquetas 
miplot <- ggplot(penguins, aes(x = species, y = body_mass_g)) +   
  geom_boxplot() +   
  labs(     
    title = "Distribución de masa corporal por especie",     
    subtitle = "Datos del estudio Palmer Penguins",     
    x = "Especie de pingüino",     
    y = "Masa corporal (g)",     
    caption = "Fuente: palmerpenguins"   
    ) miplot  

# 2a. Zoom sin eliminar datos 
miplot + coord_cartesian(ylim = c(3000, 5000))  

# 2b. Limitar eje Y eliminando observaciones 
miplot + ylim(3000, 5000)  

# 3. Bonus – color por sexo 
miplot +    
  aes(fill = sex) +    
  coord_cartesian(ylim = c(3000, 5000))
```

```{r ejercicio h}
# Ejercicio h1 - facet_grid  
ggplot(penguins, aes(x = body_mass_g, y = flipper_length_mm, color = species)) + geom_point(na.rm = TRUE) + 
  facet_grid(rows = vars(sex), cols = vars(species), scales = "free")  

# Ejercicio h2 - facet_wrap  
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species)) + geom_point(na.rm = TRUE) + 
  facet_wrap(facets = vars(island), ncol = 2, scales = "free")
```

```{r ejercicio i}
penguins_clean <- penguins %>%
  filter(
    !is.na(body_mass_g),
    !is.na(flipper_length_mm),
    !is.na(sex),
    !is.na(bill_length_mm)
  )

base_plot <- ggplot(
  penguins_clean,
  aes(
    x = body_mass_g,
    y = flipper_length_mm,
    color = species,
    shape = sex,
    size = bill_length_mm
  )
) +
  geom_point(alpha = 0.6, na.rm = TRUE)

base_plot


#Qué se consigue aquí:
  
# -Relación directa masa corporal–longitud de aleta
# -Diferenciación simultánea por especie, sexo y tamaño corporal
# -Transparencia para reducir solapamiento
# 
# 1.2 Faceting avanzado: sexo × isla

facet_grid_plot <- base_plot +
  facet_grid(
    rows = vars(sex),
    cols = vars(island)
  )

facet_grid_plot


# Este gráfico permite comparar el mismo patrón biológico entre:
# 
# Machos vs hembras (filas)
# Islas (columnas)
# 
# 1.3 Comparación con facet_wrap()
facet_wrap_plot <- base_plot +
  facet_wrap(vars(island), ncol = 3)

facet_wrap_plot


# Comparación conceptual:
#   
# facet_grid()
# Ventaja: comparación estructurada (sexo × isla)
# Ideal cuando hay dos variables categóricas con significado jerárquico
# 
# facet_wrap()
# 
# Ventaja: más flexible y compacto
# Limitación: no separa sexos claramente
# 
# 1.4 Zoom visual vs filtrado de datos
#Zoom correcto (sin eliminar datos)
zoom_plot <- facet_grid_plot +
  coord_cartesian(xlim = c(2500, 5000))

zoom_plot

#Filtrado incorrecto (elimina observaciones)
filtered_plot <- facet_grid_plot +
  xlim(2500, 5000)

filtered_plot


# Resultado esperado:
#   
# coord_cartesian() mantiene todos los datos (solo cambia la vista)
# xlim() elimina observaciones y puede distorsionar patrones
# 
# 1.5 Versión final comunicable (etiquetas + tema)
final_plot <- base_plot +
  coord_cartesian(xlim = c(2500, 5000)) +
  facet_grid(rows = vars(sex), cols = vars(island)) +
  labs(
    title = "Indicadores de vulnerabilidad metabólica en pingüinos",
    subtitle = "Individuos con menor masa corporal relativa para su longitud de aleta",
    x = "Masa corporal (g)",
    y = "Longitud de la aleta (mm)",
    color = "Especie",
    shape = "Sexo",
    size = "Longitud del pico (mm)",
    caption = "Fuente: Palmer Penguins Dataset"
  ) +
  theme_bw() +
  theme(
    legend.position = "bottom",
    legend.box = "horizontal",
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11)
  )

final_plot
```

# 
